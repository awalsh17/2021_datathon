---
title: "Some initial exploration"
author: "Alice"
date: "3/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = "asis")
```

```{r libraries, echo=FALSE, message=FALSE, warning=FALSE}
library(gtsummary)
library(readr)
library(ggplot2)
library(dplyr)
```


# Summary
This is just a stream of consciousness exploration of the data and debugging all the data manipulations.
I used the data I had already manipulated and saved locally in the 'aw_process_data.R' script.

```{r message=FALSE}
merged <- readRDS('~/Documents/merged_jat.Rds')
```

## Judge scorecard/summary
Can we filter by judge, then show some dashboard about them??

- Number of dockets
- Bail information
- Sentence information
- Facet by time, defendant information
- Social media or news about them?

Top 5 judges by year (number of dockets)
```{r}
merged %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  group_by(year) %>% 
  mutate(judge = forcats::fct_lump_n(judge, n=5))%>% 
  ungroup() %>% 
  filter(judge!="Other") %>% 
  count(year,judge, sort=F) %>% 
  pander::pander()
```


Let's take [Rayford A. Means](https://ballotpedia.org/Rayford_A._Means) as an example. 

This [article](https://digital.olivesoftware.com/Olive/ODN/PhiladelphiaInquirer/shared/ShowArticle.aspx?doc=PHQP%2F2019%2F10%2F27&entity=Ar01701&sk=614449E1&mode=text#) claims that he was sentencing for longer than other judges for retail theft.

```{r}
myjudge <- "Rayford A. Means"
```

Here I have picked `r myjudge` to examine.

```{r}
mydata <- filter(merged, judge==myjudge) # Only one docket per row

```

### Total dockets per year
```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  ggplot(aes(x=year)) + 
  geom_bar() + 
  labs(title=myjudge,
       subtitle = "Dockets per year") + 
  theme_bw()
```

### Demographics of defendants
```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  ggplot(aes(x=gender)) + 
  geom_bar() + 
  labs(title=myjudge,
       subtitle = "Defendant gender") + 
  theme_bw()
```

```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  ggplot(aes(x=race)) + 
  geom_bar() + 
  labs(title=myjudge,
       subtitle = "Defendant race") + 
  theme_bw()
```


### Dispositions
One idea would be to look at the sentences that fall outside the sentencing guidelines. Do some judges do this more or less?
```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  filter(!is.na(max_period_days_Confinement)) %>% 
  ggplot(aes(x=max_grade, group= max_grade, y= max_period_days_Confinement)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(height=0,width=0.2) + 
  scale_y_log10() + 
  labs(title=myjudge,
       subtitle = "max confinement sentences (days) by highest grade offense") + 
  theme_bw()
```

Take the case of "retail theft" - there are mutliple descriptions with some sort of retail theft. These could vary a lot, but for now, take anything with "retail theft" in it. Lots of these dockets contain other crimes that might be much more severe. A quick check says that there are some felonies.

```{r}
merged$retail_theft <- merged$desc_main_list %>% grepl(pattern = "Retail Theft|Retail theft|retail theft",unlist(.))
```

```{r}
merged %>% 
  mutate(year = lubridate::year(filing_date),
         select_judge = ifelse(judge==myjudge, T, F),
         max_sentence_all = pmax(max_period_days_Probation,max_period_days_Confinement,
                                 na.rm = T),
         included_felony = ifelse(max_grade %in% c("F","F1","F2","F3"), T, F)) %>% 
  filter(retail_theft) %>% 
  ggplot(aes(x=select_judge, group= select_judge, y= max_sentence_all)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(height=0,width=0.2, aes(color = included_felony)) + 
  # facet_wrap(~year) + 
  # scale_y_log10() + 
  labs(title=myjudge,
       x = "Is Rayford A. Means the judge?",
       subtitle = "max sentences (days confinement or probation) for retail theft") + 
  theme_bw()
```

### Bail

```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  filter(!is.na(max_bail_amount), max_bail_amount>0) %>% 
  ggplot(aes(x=max_grade, group= max_grade, y= max_bail_amount)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(height=0,width=0.2, alpha = 0.25, aes(color = year>2017)) + 
  scale_y_log10() +
  labs(title=myjudge,
       subtitle = "max bail total amount by highest grade offense",
       caption = "Note that this excludes $0 max bail") + 
  theme_bw()
```

## Other ideas

How many dockets had no bail amount > 0 ? (Could be ROR or nonmonetary)

```{r}
merged %>% 
  filter(max_bail_amount == 0) %>% 
  count(max_grade, sort=T) %>% 
  pander::pander()
```


The minimum bail per docket ranges from 1 dollar to 100,100,000 dollars

```{r}
merged %>% 
  filter(min_bail_amount>0) %>% 
ggplot( aes(x=max_grade, y= min_bail_amount))+
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(height=0, width=0.15, alpha=0.5) +
  scale_y_log10() +
  labs(title = "Min bail amount when >$0",
       subtitle = "All years") + 
  theme_bw()

```

We could imagine a dashboard to select certain years or grades. For example, here we select dockets with "S" grade as the max grade and plot by year (filing date).
```{r}
merged %>% 
  filter(min_bail_amount>0, max_grade == "S") %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
ggplot( aes(x=year, group = year, y= min_bail_amount))+
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(height=0, width=0.15, alpha=0.5) +
  scale_y_log10() +
  labs(title = "Min bail amount when >$0",
       subtitle = "Max grade of S") + 
  theme_bw()

```

```{r}
sessionInfo()
```

