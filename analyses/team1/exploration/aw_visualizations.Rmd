---
title: "Some initial exploration"
author: "Alice"
date: "3/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = "asis")
```

```{r libraries, echo=FALSE, message=FALSE, warning=FALSE}
library(gtsummary)
library(readr)
library(ggplot2)
library(dplyr)
```


# Summary
Read in the datasets from 'data_links.md' and summarize the data with the `gtsummary` package.

I used the data I had already manipulated and saved locally in the 'aw_process_data.R' script.

```{r message=FALSE}
merged <- readRDS('~/Documents/merged_jat.Rds')
```

## Judge scorecard/summary
Can we filter by judge, then show some dashboard about them??

- Number of dockets
- Bail information
- Sentence information
- Facet by time, defendant information
- Social media or news about them?

Top 5 judges by year (number of dockets)
```{r}
merged %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  group_by(year) %>% 
  mutate(judge = forcats::fct_lump_n(judge, n=5))%>% 
  ungroup() %>% 
  filter(judge!="Other") %>% 
  count(year,judge, sort=F) 
```

```{r}
myjudge <- "Rayford A. Means"
```

Here I have picked `r myjudge` to examine.

```{r}
mydata <- filter(merged, judge==myjudge)
# Only one docket per row
```

### Total dockets per year
```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  ggplot(aes(x=year)) + 
  geom_bar() + 
  labs(title=myjudge,
       subtitle = "Dockets per year") + 
  theme_bw()
```

### Demographics of defendants
```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  ggplot(aes(x=gender)) + 
  geom_bar() + 
  labs(title=myjudge,
       subtitle = "Defendant gender") + 
  theme_bw()
```

```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  ggplot(aes(x=race)) + 
  geom_bar() + 
  labs(title=myjudge,
       subtitle = "Defendant race") + 
  theme_bw()
```


### Dispositions
One idea would be to look at the sentences that fall outside the sentencing guidelines. Do some judges do this more or less?
```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  filter(!is.na(max_period_days_Confinement)) %>% 
  ggplot(aes(x=max_grade, group= max_grade, y= max_period_days_Confinement)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(height=0,width=0.2) + 
  scale_y_log10() + 
  labs(title=myjudge,
       subtitle = "max confinement sentences (days) by highest grade offense") + 
  theme_bw()
```

### Bail

```{r}
mydata %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
  filter(!is.na(max_bail_amount), max_bail_amount>0) %>% 
  ggplot(aes(x=max_grade, group= max_grade, y= max_bail_amount)) + 
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(height=0,width=0.2, alpha = 0.25, aes(color = year>2017)) + 
  scale_y_log10() +
  labs(title=myjudge,
       subtitle = "max bail total amount by highest grade offense",
       caption = "Note that this excludes $0 max bail") + 
  theme_bw()
```

## Other ideas

How many dockets had no bail amount > 0 ? (Could be ROR or nonmonetary)

```{r}
merged %>% 
  filter(max_bail_amount == 0) %>% 
  count(max_grade, sort=T) %>% 
  pander::pander()
```

What about bail == 0 by representation type?
```{r}
merged %>% 
  mutate(zero_bail = ifelse(max_bail_amount == 0, T, F)) %>% 
  count(representation_type, zero_bail, sort=T) %>% 
  pander::pander()
```

The minimum bail per docket ranges from 1 dollar to 100,100,000 dollars

```{r}
merged %>% 
  filter(min_bail_amount>0) %>% 
ggplot( aes(x=max_grade, y= min_bail_amount))+
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(height=0, width=0.15, alpha=0.5) +
  scale_y_log10() +
  labs(title = "Min bail amount when >$0",
       subtitle = "All years") + 
  theme_bw()

```

We could imagine a dashboard to select certain years or grades. For example, here we select dockets with "S" grade as the max grade and plot by year (filing date).
```{r}
merged %>% 
  filter(min_bail_amount>0, max_grade == "S") %>% 
  mutate(year = lubridate::year(filing_date)) %>% 
ggplot( aes(x=year, group = year, y= min_bail_amount))+
  geom_boxplot(outlier.shape = NA) +
  geom_jitter(height=0, width=0.15, alpha=0.5) +
  scale_y_log10() +
  labs(title = "Min bail amount when >$0",
       subtitle = "Max grade of S") + 
  theme_bw()

```

```{r}
sessionInfo()
```

